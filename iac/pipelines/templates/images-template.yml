parameters:
  registryName: ''
  pipelineAcrConnection: ''
  basePath: ''
  dockerFilePath: ''
  selectedImage: ''  
  images:
  - name: analyzer
    imageName: 'backend_analyzer'
    imageFolder: analyzer
    imageVersion: ''
  - name: beapi
    imageName: 'backend_beapi'
    imageFolder: beapi
    imageVersion: ''
  - name: infra
    imageName: 'backend_infra'
    imageFolder: infra
    imageVersion: ''
  - name: mongowriter
    imageName: 'backend_mongowriter'
    imageFolder: mongowriter
    imageVersion: ''
  - name: twinlistener
    imageName: 'backend_twinlistener'
    imageFolder: twinlistener
    imageVersion: ''
  - name: unittests
    imageName: 'backend_unittests'
    imageFolder: unittests
    imageVersion: ''
  - name: blobstreamer
    imageName: 'backend_blobstreamer'
    imageFolder: Backend.BlobStreamer
    imageVersion: ''
  - name: iotlistener
    imageName: 'backend_iotlistener'
    imageFolder: Backend.IoTListener
    imageVersion: ''
  - name: keyholder
    imageName: 'backend_keyholder'
    imageFolder: Backend.KeyHolder
    imageVersion: ''
  - name: edge_conquest
    imageName: 'edge_conquest'
    # imagePath: './src/edge/conquest/'
    # imageVersion: 'v0.7.3'
    # dockerFilePath: './src/edge/conquest/Dockerfile'
  
steps:
- script: |
    selectedImage='${{ parameters.selectedImage }}'
    basePath='${{ parameters.basePath }}'
    dockerFilePath='${{ parameters.dockerFilePath }}'
    # Iterate through the images and set variables for the selected image
    for image in "${{ parameters.images }}"; do
      if [ "$selectedImage" == "${{ image.name }}" ]; then
        echo "##vso[task.setvariable variable=imageName;]${{ image.imageName }}"
        echo "##vso[task.setvariable variable=imageVersion;]${{ image.imageVersion }}"
        echo "##vso[task.setvariable variable=imagePath;]${basePath}/${{ image.imageFolder }}"
        echo "##vso[task.setvariable variable=dockerFilePath;]${dockerFilePath}"
      fi
    done
  displayName: 'Set Image Information Variables'
