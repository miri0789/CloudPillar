parameters:
  imageName: ''
  imagePath: ''
  dockerFilePath: ''
  imageVersion: ''
  pipelineAcrConnection: ''
  registryName: ''
  AGENT_POOL: ''
  AGENT_NAME: ''



# variables:
# - group: arm-vg
# - group: iac-backend-vg
# - group: aks-backend-vg
# - group: backend-secrets-vg

- stage: BuildScanPush
  - job: RetrieveImageInfo
    pool:
      name: $(AGENT_POOL)
      agent.name: aks-${{parameters.env}}-agent    
    displayName: Retrieve Image Information
    # condition: ne('${{ parameters.image }}', 'edge_conquest')
    condition: ne('${{ parameters.image }}', 'all')
    steps:
    # - checkout: self
    #   persistCredentials: true
    #   clean: true    
    - template: 'templates/images-template.yml'
      parameters:
        selectedImage: ${{ parameters.image }} # Pass the selected image as a parameter
        imageVersion: $(major).$(minor).$(GitBuildNumber).$(TIME)
        registryName: $(registryName)
        pipelineAcrConnection: $(pipelineAcrConnection)