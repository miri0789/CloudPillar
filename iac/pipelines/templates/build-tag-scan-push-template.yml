parameters:
  imageName: ''
  imagePath: ''
  dockerFilePath: ''
  imageVersion: ''
  pipelineAcrConnection: ''
  registryName: ''
  AGENT_POOL: ''
  AGENT_NAME: ''



# variables:
# - group: arm-vg
# - group: iac-backend-vg
# - group: aks-backend-vg
# - group: backend-secrets-vg

steps:
- checkout: self
  persistCredentials: true
  clean: true
- template: 'images-template.yml'
  dependsOn: RetrieveImageInfo  
  parameters:
    imageName: "$[ dependencies.RetrieveImageInfo.outputs['setImageInfo.imageName'] ]"
    imageVersion: "$[ dependencies.RetrieveImageInfo.outputs['setImageInfo.imageVersion'] ]"
    imagePath: "$[ dependencies.RetrieveImageInfo.outputs['setImageInfo.imagePath'] ]"
    dockerFilePath: "$[ dependencies.RetrieveImageInfo.outputs['setImageInfo.dockerFilePath'] ]"
    registryName: "$[ dependencies.RetrieveImageInfo.outputs['setImageInfo.registryName'] ]"
    pipelineAcrConnection: "$[ dependencies.RetrieveImageInfo.outputs['setImageInfo.pipelineAcrConnection'] ]"
    selectedImage: ${{ parameters.image }}
- task: Bash@3
  variables:
    imageName: $[ dependencies.RetrieveImageInfo.outputs['setImageInfo.imageName'] ]
    imageVersion: $[ dependencies.RetrieveImageInfo.outputs['setImageInfo.imageVersion'] ]
    imagePath: $[ dependencies.RetrieveImageInfo.outputs['setImageInfo.imagePath'] ]
    dockerFilePath: $[ dependencies.RetrieveImageInfo.outputs['setImageInfo.dockerFilePath'] ] 
    registryName: $[ dependencies.RetrieveImageInfo.outputs['setImageInfo.registryName'] ]
    pipelineAcrConnection: $[ dependencies.RetrieveImageInfo.outputs['setImageInfo.pipelineAcrConnection'] ]
  inputs:
    targetType: 'inline'
    script: |
      echo 'selectedImage: ${{ parameters.imageName }}'
      echo 'imageVersion: ${{ parameters.imageVersion }}'
      echo 'imagePath: ${{ parameters.imagePath }}'
      echo 'imagePath: ${{ parameters.imagePath }}'
      echo 'registryName: ${{ parameters.registry }}'
      echo 'pipelineAcrConnection: ${{ parameters.pipelineAcrConnection }}'

    name: printParameters
      
