
name: ci_build

trigger:
- $(Build.SourceBranchName)



parameters:
  - name: env
    displayName: Select Environment to deploy
    type: string
    default: dev
    values:
    - tst
    - dev
    - stg
    - prd

variables:
- group: arm-vg

stages:
- stage: Versioning
  displayName: 'Versioning Update Process'
  jobs:
  - job: GetFileChanges
    displayName: Getting Changed Files 
    pool:
      name: $(AGENT_POOL)
      agent.name: aks-${{parameters.env}}-agent 
    steps:
    - checkout: self
    # - checkout: git://CloudPillar@CloudPillar$(Build.SourceBranch)
      persistCredentials: true
      clean: true
    - task: Bash@3
      displayName: Get Changed Files
      inputs:
        targetType: inline
        script: |
          
          SourceBranch=$(Build.SourceBranchName)
          CurrentBranch=$(git symbolic-ref --short HEAD)
          CurrentBranch2=$(git branch | sed -n '1{s/^* *//;p})
          CurrentBranch3=$(git branch --show-current)
          
          # CurrentBranch=$(git rev-parse --abbrev-ref HEAD)



          echo "Source Branch Name: $(Build.SourceBranchName)"
          echo "Current Branch Name: $CurrentBranch"
          echo "Current Branch Name2: $CurrentBranch2"
          echo "Current Branch Name3: $CurrentBranch3"

          # git diff-tree --no-commit-id --name-only -r $(Build.SourceVersion)
          # git diff-tree --no-commit-id --name-only -r $(Build.SourceVersion)
          differences=$(git diff-tree --no-commit-id --name-only -r $CurrentBranch)
          differences2=$(git diff-tree --no-commit-id --name-only -r $CurrentBranch2)
          echo "Differences: $differences"
          echo "Differences2: $differences2"

          printf "Tree:\n"
          tree ./














































